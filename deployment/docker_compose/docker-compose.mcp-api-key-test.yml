name: onyx

services:
  mcp_api_key_server:
    image: ${ONYX_BACKEND_IMAGE:-onyxdotapp/onyx-backend:latest}
    restart: on-failure
    working_dir: /workspace
    environment:
      - MCP_API_KEY_TEST_PORT=${MCP_API_KEY_TEST_PORT:-8005}
      - MCP_API_KEY=${MCP_API_KEY:-test-api-key-12345}
      - MCP_SERVER_HOST=${MCP_API_KEY_SERVER_HOST:-0.0.0.0}
      - MCP_SERVER_PUBLIC_HOST=${MCP_API_KEY_SERVER_PUBLIC_HOST:-host.docker.internal}
    command: >
      /bin/sh -c "
      python backend/tests/integration/mock_services/mcp_test_server/run_mcp_server_api_key.py ${MCP_API_KEY:-test-api-key-12345} ${MCP_API_KEY_TEST_PORT:-8005}
      "
    ports:
      - "${MCP_API_KEY_TEST_PORT:-8005}:${MCP_API_KEY_TEST_PORT:-8005}"
    volumes:
      - ../..:/workspace:ro

