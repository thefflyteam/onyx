name: onyx

services:
  mcp_oauth_server:
    image: onyxdotapp/onyx-backend:${IMAGE_TAG:-latest}
    restart: on-failure
    working_dir: /workspace
    environment:
      - MCP_OAUTH_CLIENT_ID=${MCP_OAUTH_CLIENT_ID:-}
      - MCP_OAUTH_CLIENT_SECRET=${MCP_OAUTH_CLIENT_SECRET:-}
      - MCP_OAUTH_ISSUER=${MCP_OAUTH_ISSUER:-}
      - MCP_OAUTH_JWKS_URI=${MCP_OAUTH_JWKS_URI:-}
      - MCP_OAUTH_USERNAME=${MCP_OAUTH_USERNAME:-}
      - MCP_OAUTH_PASSWORD=${MCP_OAUTH_PASSWORD:-}
      - MCP_OAUTH_REQUIRED_SCOPES=${MCP_OAUTH_REQUIRED_SCOPES:-mcp:use}
      - MCP_TEST_SERVER_PORT=${MCP_TEST_SERVER_PORT:-8004}
      - MCP_SERVER_PORT=${MCP_TEST_SERVER_PORT:-8004}
      - MCP_SERVER_HOST=${MCP_SERVER_HOST:-0.0.0.0}
      - MCP_SERVER_PUBLIC_HOST=${MCP_SERVER_PUBLIC_HOST:-host.docker.internal}
      - MCP_SERVER_PUBLIC_URL=${MCP_SERVER_PUBLIC_URL:-}
    command: >
      /bin/sh -c "
      python backend/tests/integration/mock_services/mcp_test_server/run_mcp_server_oauth.py ${MCP_TEST_SERVER_PORT:-8004}
      "
    ports:
      - "${MCP_TEST_SERVER_PORT:-8004}:${MCP_TEST_SERVER_PORT:-8004}"
    volumes:
      - ../..:/workspace:ro

